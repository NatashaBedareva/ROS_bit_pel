# AutoRace. Решение Битовые пельмени

## Запуск
1. Скачать репозиторий ROS_bit_pel
2. Скачать репозиторий my_robot
3. Запустить решение

Терминал 1:
```bash
ros2 launch robot_bringup autorace_2025.launch.py
```
Терминал 2:
```bash
ros2 launch bitovie_pelmeni bitovie_pelmeni.launch.py (https://bitovie_pelmeni.launch.py/)
```
Терминал 3:
```bash
ros2 run referee_console mission_autorace_2025_referee
```


## Основные использованные пакеты ROS 2
1. **rclpy** - Python клиентская библиотека ROS 2
2. **std_msgs** - Стандартные типы сообщений ROS (Empty, String)
3. **geometry_msgs** - Геометрические типы сообщений (Twist)
4. **sensor_msgs** - Типы сообщений для сенсоров (Image)
5. **nav_msgs** - Типы сообщений для навигации (Odometry)
6. **rcl_interfaces** - Интерфейсы для работы с параметрами (ParameterDescriptor, ParameterType)
7. **cv_bridge** - Конвертация между ROS Image и OpenCV изображениями

## Дополнительные пакеты
8. **tf_transformations** - Утилиты для работы с преобразованиями координат (euler_from_quaternion)

## Зависимости Python
9. **OpenCV (cv2)** - Компьютерное зрение для обработки изображений
10. **NumPy** - Численные вычисления и работа с массивами

## Разработанные компоненты

### Основной узел ROS: Follow_Trace_Node

#### 1. Система управления движением
- **PID-регулятор** для плавного следования по центру дороги
- **Адаптивная система скорости** с уменьшением скорости на поворотах
- **Механизм восстановления** при потере линии слежения

#### 2. Обработка компьютерного зрения

<img width="638" height="572" alt="image" src="https://github.com/user-attachments/assets/b0e99b59-3e65-48ce-a695-5312a7a28301" />

##### Детекция линий дорожной разметки:
- **Метод `_find_yellow_line`** - обнаружение желтой линии с использованием:
  - Преобразования в HSV цветовое пространство
  - Морфологических операций для очистки изображения
  - Контурного анализа для определения правого края желтой линии

- **Метод `_find_white_line`** - обнаружение белой линии с использованием:
  - Адаптивной бинаризации по порогу яркости
  - Комбинации grayscale и HSV методов
  - Контурного анализа для определения левого края белой линии

##### Перспективное преобразование:
- **Метод `_warpPerspective`** - преобразование вида "сбоку" в вид "сверху"
- Настраиваемые области интереса для лучшего обзора дороги

#### 3. Система обработки перекрестков

##### Управление остановками:
- **Детекция знака** с временной остановкой на 3 секунды
- **Интеллектуальный игнорирование** знака после первой остановки
- **Визуализация состояния** остановки

#### 4. Модуль анализа дорожных знаков (traffic_direction.py)
<img width="243" height="154" alt="image" src="https://github.com/user-attachments/assets/664ac9f5-4690-48d4-afa8-ecc438f1b9c7" />

##### Детекция синих дорожных знаков:
- **Метод `check_blue_color`** - выделение синего цвета с использованием HSV диапазонов
- **Адаптивный подбор параметров** для работы в различных условиях освещения

##### Распознавание знака "STOP":
- **Метод `check_stop_sign`** - комплексная проверка знака остановки:
  - Анализ концентрации синих пикселей в ROI области
  - Проверка круглости контура для фильтрации ложных срабатываний

##### Анализ стрелок направления:
- **Метод `analyze_arrow_direction`** - определение направления поворота:
  - Двухэтапный подход: RGB и HSV анализ
  - Выделение серых/белых пикселей стрелок на синем фоне
  - **Пространственный анализ** - сравнение распределения пикселей в левой и правой частях знака

##### Выделение областей знаков:
- **Метод `extract_sign_region`** - сегментация области дорожного знака
  - Контурный анализ для точного выделения границ
  - Фильтрация по минимальной площади для устранения шума

#### 5. Модуль светофора (traffic_light.py)

##### Детекция зеленого света:
- **Метод `check_green_color`** - определение зеленого сигнала светофора:
  - Использование HSV цветового пространства

##### Управление началом движения:
- **Метод `check_traffic_lights`** - контроль старта робота:
  - Автоматический переход от TASK_LEVEL 0 к 1 при обнаружении зеленого
  - Изменение STATUS_CAR для активации системы движения

#### 6. Режим отладки (INFO_LEVEL):
- **Детальное отображение** линий и центров на изображении
- **Подписи** с параметрами работы
- **Окна статуса** для остановок, поворотов и поиска линии
- **Визуализация всех этапов обработки**:
  - Исходное изображение с камеры
  - Дорожная разметка с центрами
  - Детекция знаков и стрелок
  - Состояние робота и принятые решения
